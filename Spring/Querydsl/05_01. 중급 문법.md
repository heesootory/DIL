# ì¤‘ê¸‰ ë¬¸ë²•



<br>
<br>
<br>

## ğŸŒˆ í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜ - ê¸°ë³¸

<br>

> í”„ë¡œì ì…˜ ì´ë€?? : select ëŒ€ìƒ ì§€ì •.

* í”„ë¡œì ì…˜ ëŒ€ìƒì´ í•˜ë‚˜ì¼ë•Œ
    - íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìˆìŒ.
    - ê¸°ë³¸íƒ€ì…(String) ì´ê±°ë‚˜ ì—”í‹°í‹° íƒ€ì… í•˜ë‚˜(member)

* ì˜ˆì‹œì½”ë“œ

```java
// í”„ë¡œì ì…˜ : member.username/ í”„ë¡œì ì…˜ íƒ€ì… : String
List<String> result = queryFactory
          .select(member.username)
          .from(member)
          .fetch();
```

<br>
<br>

* í”„ë¡œì ì…˜ íƒ€ì…ì´ ë‘˜ ì´ìƒ ì¼ë•Œ
    - íŠœí”Œì´ë‚˜ DTO ì‚¬ìš©.
        - íŠœí”Œ : Querydslì´ ì—¬ëŸ¬ê°œ íƒ€ì…ì„ ë°›ì„ ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ë†“ì€ íƒ€ì….
    - com.querydsl.core.Tuple ì‚¬ìš©.
        - ğŸ€ íŠœí”Œ íƒ€ì…ì€ ë¦¬í¬ì§€í† ë¦¬ ê³„ì¸µ ì•ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ê±´ ê´œì°®ì¹˜ë§Œ, serviceë‚˜ controllerê¹Œì§€ ë„˜ì–´ê°€ëŠ” ì„¤ê³„ë¥¼ í•˜ëŠ” ê±´ ì¢‹ì§€ ì•Šë‹¤. -> ê·¸ë˜ì•¼ í•˜ë¶€ ê³„ì¸µ(ë¦¬í¬ì§€í† ë¦¬)ë¥¼ ë‹¤ë¥¸ ê¸°ìˆ ë¡œ ë°”ê¾¸ë”ë¼ë„ ë‹¤ë¥¸ ê³„ì¸µì— ì˜í–¥ì„ ì•ˆë¯¸ì¹˜ê²Œ ì„¤ê³„ê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸! ğŸ€ -> ë‚˜ê°ˆ ë•ŒëŠ” DTOë³€í™˜í•´ì„œ ë‚˜ê°€ì.

* ì˜ˆì‹œì½”ë“œ

```java
List<Tuple> result = queryFactory
                        .select(member.username, member.age)
                        .from(member)
                        .fetch();
  
    for (Tuple tuple : result) {
        String username = tuple.get(member.username);
        Integer age = tuple.get(member.age);
        System.out.println("username=" + username);
        System.out.println("age=" + age);
}
```


<br>
<br>
<hr>
<br>
<br>

## ğŸŒˆ í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜ - DTO ì¡°íšŒ

<br>

* DTOë¡œ ì¡°íšŒë¥¼ í•œë‹¤ëŠ” ì˜ë¯¸ëŠ” DTOì— ë§Œë“¤ì–´ ë†“ì€ ìƒì„±ìì— ë§ê²Œ (ë§ˆì¹˜ ì›í•˜ëŠ” í†µì„ ë§Œë“¤ì–´ ë†“ê³  ë‹´ëŠ” ëŠë‚Œ) ê·¸ê²ƒë§Œ ì¡°íšŒí•´ì„œ ì•Œë§ê²Œ í¼ì˜¬ë¦°ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

<br>
<br>


### ğŸ³ ìˆœìˆ˜ JPAì—ì„œ DTO ì¡°íšŒ.

* ìˆœìˆ˜ JPA ì—ì„œëŠ” DTOë¡œ ì¡°íšŒì‹œ, ë§ˆì¹˜ ìƒì„±ìë¥¼ ìƒì„±í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ newëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼í•œë‹¤.

* ë‹¨ì  : DTOì˜ package ì´ë¦„ì„ ë‹¤ ì ì–´ì¤˜ì•¼í•´ì„œ ì§€ì €ë¶„í•¨.

* ìƒì„±ì ë°©ì‹ë§Œ ì§€ì›.

* ì˜ˆì‹œì½”ë“œ
     - DTO
        ```java
        package study.querydsl.dto;

        import lombok.Data;

        @Data
        public class MemberDto {
            private String username;
            private int age;

            public MemberDto() {}

            public MemberDto(String username, int age) {
                this.username = username;
                this.age = age;
            } 
        }
        ```
    - ìˆœìˆ˜ JPA (new operationì„ í™œìš©í•œ ë°©ë²•)
        ```java
        List<MemberDto> result = em.createQuery(
            "select new study.querydsl.dto.MemberDto(m.username, m.age) " +
            "from Member m", MemberDto.class)
            .getResultList();
        ```

<br>
<br>

### ğŸ³ Querydsl ë¹ˆ ìƒì„±(Bean population)

<br>

* 3ê°€ì§€ ë°©ë²•ì„ ì§€ì›.
    - í”„ë¡œí¼í‹° ì ‘ê·¼
    - í•„ë“œ ì§ì ‘ ì ‘ê·¼.
    - ìƒì„±ì ì‚¬ìš©.


* í”„ë¡œí¼í‹° ì ‘ê·¼ - setter ì‚¬ìš©
    - MemberDtoì— í•´ë‹¹ í•„ë“œë³€ìˆ˜ëª…ì˜ setterê°€ ì¡´ì¬í•´ì•¼í•¨.
    - Projections.bean ì‚¬ìš©.
    - MemberDtoì— ê¸°ë³¸ìƒì„±ìê°€ ì¡´ì¬í•´ì•¼ ê°€ëŠ¥!


        ```java
        List<MemberDto> result = queryFactory
                                    .select(Projections.bean(MemberDto.class,
                                            member.username,
                                            member.age))
                                    .from(member)
                                    .fetch();
        ```

* í•„ë“œ ì§ì ‘ ì ‘ê·¼
    - MemberDtoì— setterê°€ ì—†ì–´ë„ í•„ë“œì˜ ë³€ìˆ˜ì— ë°”ë¡œ ê½‚ì•„ë²„ë¦¼.
    - Projections.fields ì‚¬ìš©
        
        ```java
        List<MemberDto> result = queryFactory
                                    .select(Projections.fields(MemberDto.class,
                                            member.username,
                                            member.age))
                                    .from(member)
                                    .fetch();
        ```


* ìƒì„±ì ì‚¬ìš©
     - Projections.fields ì‚¬ìš©.
     - MemberDtoì— ì•Œë§ì€ ìƒì„±ìëŠ” ì¡´ì¬í•´ì•¼ í•¨.
     - ê°€ì ¸ì˜¤ë ¤ëŠ” ë³€ìˆ˜ì™€ MemberDtoì˜ í•„ë“œë³€ìˆ˜ì˜ íƒ€ì…ì´ ì •í™•íˆ ì¼ì¹˜í•˜ë©´ ê°€ëŠ¥.(ë³€ìˆ˜ëª…ì´ ì•ˆë§ì•„ë„ íƒ€ì…ì— ë§¤ì¹˜ë˜ì„œ ë“¤ì–´ê°)

        ```java
        List<MemberDto> result = queryFactory
                                    .select(Projections.constructor(MemberDto.class,
                                            member.username,
                                            member.age))
                                    .from(member)
                                    .fetch();
        ```

* ì˜ˆì™¸ìƒí™©
    - ë³„ì¹­ì´ ë‹¤ë¥¼ë•Œ
        - username.as("memberName") : í•„ë“œì— ë³„ì¹­ ì ìš©
    - ì—”í‹°í‹°ì— ì—†ëŠ” ê°’ì„ ë°”ë¡œ DTOë¡œ ì§‘ì–´ ë„£ì–´ì•¼ í• ë•Œ
        - ExpressionUtils.as(source,alias) : í•„ë“œë‚˜, ì„œë¸Œ ì¿¼ë¦¬ì— ë³„ì¹­ ì ìš©
        ```java
        package study.querydsl.dto;
        import lombok.Data;

        @Data
        public class UserDto {
            private String name;
            private int age;
        }

        List<UserDto> fetch = queryFactory
        .select(Projections.fields(UserDto.class,
                member.username.as("name"),  // ë³„ì¹­ì´ ë‹¤ë¥¼ë•Œ
                ExpressionUtils.as(         // ì„œë¸Œì¿¼ë¦¬ë¡œ ê°’ ë§Œë“¤ì–´ì„œ ë„£ê¸°
                        JPAExpressions
                                .select(memberSub.age.max())
                                .from(memberSub), "age")

                )
        ).from(member)
        .fetch();
        ```










