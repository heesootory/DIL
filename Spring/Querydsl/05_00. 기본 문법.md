# ê¸°ë³¸ ë¬¸ë²•


<br>
<br>
<br>

## ğŸŒˆ JPQL vs Querydsl ë¹„êµ

<br>

* JPQL: ë¬¸ì(runtime ì‹œì  ì˜¤ë¥˜) / Querydsl: ì½”ë“œ(ì»´íŒŒì¼ ì‹œì  ì˜¤ë¥˜)

* JPQL : íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì§ì ‘ / Querydsl : íŒŒë¼ë””í„° ë°”ì¸ë”© ìë™ ì²˜ë¦¬.



* JPQL

    ```java
    @Test
    public void startJPQL() {
        //member1ì„ ì°¾ì•„ë¼.
        String qlString =
            "select m from Member m " +
            "where m.username = :username";

        Member findMember = em.createQuery(qlString, Member.class)
                                .setParameter("username", "member1")
                                .getSingleResult();

        assertThat(findMember.getUsername()).isEqualTo("member1");
    }
    ```

* Querydsl

    - EntityManager ë¡œ JPAQueryFactory ìƒì„±
    - Querydslì€ JPQL ë¹Œë”
    - JPAQueryFactory queryFactory = new JPAQueryFactory(em); ë¥¼ í•„ë“œë¡œ ê°€ì ¸ë„ ë™ì‹œì„± ë¬¸ì œê°€ ì—†ê²Œ ì„¤ê³„ë˜ì—ˆë‹¤.(ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ì£¼ì…í•´ì£¼ëŠ” ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ ë©€í‹° ì“°ë ˆë“œê°€ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„ë¨.)

    ```java
    @Test
    public void startQuerydsl() {
        //member1ì„ ì°¾ì•„ë¼.
        JPAQueryFactory queryFactory = new JPAQueryFactory(em);
        QMember m = new QMember("m");

        Member findMember = queryFactory
        .select(m)
        .from(m)
        .where(m.username.eq("member1"))//íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì²˜ë¦¬
        .fetchOne();

        assertThat(findMember.getUsername()).isEqualTo("member1");
    }
    ```

<br>
<br>
<hr>
<br>
<br>


## ğŸŒˆ ê¸°ë³¸ Q-Type í™œìš©

<br>

* Qí´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” 2ê°€ì§€ ë°©ë²•
    - ê°™ì€ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ëŠ” ê²½ìš°ì—ë§Œ ë³„ì¹­ì„ ì§ì ‘ ì§€ì •í•´ì„œ ì‚¬ìš©í•˜ê³ , ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ê¸°ë³¸ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì!
    ```java
    QMember qMember = new QMember("m"); //ë³„ì¹­ ì§ì ‘ ì§€ì •
    QMember qMember = QMember.member; //ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
    ```


* ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ static importì™€ í•¨ê»˜ ì‚¬ìš©.

```java
import static study.querydsl.entity.QMember.*;

@Test
public void startQuerydsl3() {
    //member1ì„ ì°¾ì•„ë¼.
    Member findMember = queryFactory
                    .select(member)
                    .from(member)
                    .where(member.username.eq("member1"))
                    .fetchOne();
                    
    assertThat(findMember.getUsername()).isEqualTo("member1");
}
```

* JPQL ì¿¼ë¦¬ë¡œ í™•ì¸í•˜ê¸°
    - ê²°êµ­ Querydslë„ JPQL ì¿¼ë¦¬ë¡œ ë°”ë€ í›„ ì²˜ë¦¬ ëœë‹¤.
    - Querydsl ì€ JPQLì˜ ë¹Œë” ì—­í• !
    - yml íŒŒì¼ì— ì¶”ê°€í•˜ë©´ ì‹¤í–‰ë˜ëŠ” JQPLì„ ë³¼ ìˆ˜ ìˆë‹¤.
        ```java
        spring.jpa.properties.hibernate.use_sql_comments: true
        ``` 


<br>
<br>
<hr>
<br>
<br>


## ğŸŒˆ ê²€ìƒ‰ ì¡°ê±´ ì¿¼ë¦¬


<br>

* select ê³¼ from ì€ í•©ì³ì„œ selectFromìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥.

* ì¡°ê±´ë¬¸ where
    - and ë‚˜ orì„ ì´ìš©í•´ì„œ ë©”ì„œë“œ ì²´ì¸ìœ¼ë¡œ ì—°ê²° ê°€ëŠ¥.

* ì˜ˆì‹œ ì½”ë“œ
    ```java
    @Test
    public void search() {
        Member findMember = queryFactory
                            .selectFrom(member)
                            .where(member.username.eq("member1")
                            .and(member.age.eq(10)))
                            .fetchOne();

        assertThat(findMember.getUsername()).isEqualTo("member1");
    }
    ```

* AND ì¡°ê±´ì€ -> ","(ì½¤ë§ˆ) ë¡œ ì²˜ë¦¬ ê°€ëŠ¥.
    - ì½¤ë§ˆ ì¤‘ê°„ì— ë“¤ì–´ì˜¤ëŠ” nullì€ ë¬´ì‹œí•œë‹¤. -> ì¶”í›„ ë™ì  ì¿¼ë¦¬ë¥¼ ë§Œë“¤ë•Œ ê¹”ë”í•˜ê²Œ ì§¤ ìˆ˜ ìˆë‹¤.




<br>
<br>

### ğŸ³ JPQLì´ ì œê³µí•˜ëŠ” ëª¨ë“  ê²€ìƒ‰ ì¡°ê±´ ì œê³µ

```java
member.username.eq("member1") // username = 'member1'
member.username.ne("member1") //username != 'member1'
member.username.eq("member1").not() // username != 'member1'
member.username.isNotNull() //ì´ë¦„ì´ is not null

member.age.in(10, 20) // age in (10,20)
member.age.notIn(10, 20) // age not in (10, 20)
member.age.between(10,30) //between 10, 30
member.age.goe(30) // age >= 30
member.age.gt(30) // age > 30
member.age.loe(30) // age <= 30
member.age.lt(30) // age < 30

member.username.like("member%") //like ê²€ìƒ‰
member.username.contains("member") // like â€˜%member%â€™ ê²€ìƒ‰
member.username.startsWith("member") //like â€˜member%â€™ ê²€ìƒ‰
```


<br>
<br>
<hr>
<br>
<br>



## ğŸŒˆ ê²°ê³¼ ì¡°íšŒ

* fetch() : ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ, ë°ì´í„° ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
* fetchOne() : ë‹¨ ê±´ ì¡°íšŒ
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ : null
    - ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë©´ : com.querydsl.core.NonUniqueResultException
* fetchFirst() : limit(1).fetchOne() ->  ì²˜ìŒ í•œê±´ ì¡°íšŒ.
* fetchResults() : í˜ì´ì§• ì •ë³´ í¬í•¨, total count ì¿¼ë¦¬ ì¶”ê°€ ì‹¤í–‰
* fetchCount() : count ì¿¼ë¦¬ë¡œ ë³€ê²½í•´ì„œ count ìˆ˜ ì¡°íšŒ



* ì˜ˆì‹œ ì½”ë“œ
    ```java
    //í˜ì´ì§•ì—ì„œ ì‚¬ìš© -  í˜ì´ì§•ì—ì„œ í™œìš©ë  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ í•¨ìˆ˜ë“¤ì„ í™œìš©.
    QueryResults<Member> results = queryFactory
    .selectFrom(member)
    .fetchResults();

    results.getTotal(); // ì¹´ìš´íŠ¸ë§Œ ì¶œë ¥.
    List<Member> content = results.getResults();    // ë¦¬ìŠ¤íŠ¸ë¡œ ì¶œë ¥.


    //count ì¿¼ë¦¬ë¡œ ë³€ê²½
    long count = queryFactory
    .selectFrom(member)
    .fetchCount();

    ```


<br>
<br>
<hr>
<br>
<br>

## ğŸŒˆ ì •ë ¬

<br>

* ì£¼ìš” í•¨ìˆ˜ ì •ë¦¬
    - desc(), asc() : ì¼ë°˜ ì •ë ¬.
    - nullsLast(), nullsFirst() : null ë°ì´í„° ìˆœì„œ ë¶€ì—¬.

* ì˜ˆì‹œì½”ë“œ

```java
/**
* íšŒì› ì •ë ¬ ìˆœì„œ
* 1. íšŒì› ë‚˜ì´ ë‚´ë¦¼ì°¨ìˆœ(desc)
* 2. íšŒì› ì´ë¦„ ì˜¬ë¦¼ì°¨ìˆœ(asc)
* ë‹¨ 2ì—ì„œ íšŒì› ì´ë¦„ì´ ì—†ìœ¼ë©´ ë§ˆì§€ë§‰ì— ì¶œë ¥(nulls last)
*/
@Test
public void sort() {
    em.persist(new Member(null, 100));
    em.persist(new Member("member5", 100));
    em.persist(new Member("member6", 100));

    List<Member> result = queryFactory
                            .selectFrom(member)
                            .where(member.age.eq(100))
                            .orderBy(member.age.desc(), member.username.asc().nullsLast())
                            .fetch();

    Member member5 = result.get(0);
    Member member6 = result.get(1);
    Member memberNull = result.get(2);

    assertThat(member5.getUsername()).isEqualTo("member5");
    assertThat(member6.getUsername()).isEqualTo("member6");
    assertThat(memberNull.getUsername()).isNull();
}
```


<br>
<br>
<hr>
<br>
<br>

## ğŸŒˆ í˜ì´ì§•

<br>


* ì˜ˆì‹œì½”ë“œ
    - ì¡°íšŒ ê±´ìˆ˜ ì œí•œ.
        ```java
        @Test
        public void paging1() {
            List<Member> result = queryFactory
                                    .selectFrom(member)
                                    .orderBy(member.username.desc())
                                    .offset(1) //0ë¶€í„° ì‹œì‘(zero index)
                                    .limit(2) //ìµœëŒ€ 2ê±´ ì¡°íšŒ
                                    .fetch();

            assertThat(result.size()).isEqualTo(2);
        }
        ```

    - ì „ì²´ ì¡°íšŒ ìˆ˜ê°€ í•„ìš”í• ë•Œ
        - count ì¿¼ë¦¬ê°€ ë¨¼ì € ì‹¤í–‰ëœ í›„ì— contentì— ê´€í•œ ì¿¼ë¦¬ê°€ ë‚˜ê°.
        - ì‹¤ì œë¡œëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ëŠ” ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì¡°ì¸í•´ì•¼ í•˜ì§€ë§Œ, countì¿¼ë¦¬ëŠ” ì¡°ì¸ì´ í•„ìš”ì—†ëŠ” ê²½ìš°ë„ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.(left outer join) ê·¸ëŸ°ë° ì´ë ‡ê²Œ ìë™í™”ëœ count ì¿¼ë¦¬ëŠ” ì›ë³¸ ì¿¼ë¦¬ì™€ ê°™ì´ ëª¨ë‘ ì¡°ì¸ì„ í•´ë²„ë¦¬ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. countì¿¼ë¦¬ì— ì¡°ì¸ì´ í•„ìš”ì—†ëŠ” ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•˜ë‹¤ë©´, countì „ìš© ì¿¼ë¦¬ë¥¼ ë³„ë„ë¡œ ì‘ì„±í•˜ì.
    
    ```java
    @Test
    public void paging2() {
        QueryResults<Member> queryResults = queryFactory
                                            .selectFrom(member)
                                            .orderBy(member.username.desc())
                                            .offset(1)
                                            .limit(2)
                                            .fetchResults();

        assertThat(queryResults.getTotal()).isEqualTo(4);
        assertThat(queryResults.getLimit()).isEqualTo(2);
        assertThat(queryResults.getOffset()).isEqualTo(1);
        assertThat(queryResults.getResults().size()).isEqualTo(2);
    }
    ```


<br>
<br>
<hr>
<br>
<br>

## ğŸŒˆ ì§‘í•©

<br>














