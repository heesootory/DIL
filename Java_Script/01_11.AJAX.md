# AJAX



## Asynchronous JAvaScript and XML

* ë¹„ë™ê¸° ë°©ì‹ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ XML

* AJAX Apps
    - êµ¬ê¸€ë§µ, VIBE, ë„¤ì´ë²„ ê²€ìƒ‰ ë“±...

* ì§ê´€ì ì´ê³  ìì—°ìŠ¤ëŸ¬ìš´ ì‚¬ìš©ì ìƒí˜¸ì•¡ì…˜ ë°©ì‹
    - ê¸°ì¡´ í´ë¦­ì´ í•„ìš”í•˜ì§€ ì•ŠìŒ.

* í™”ë©´ì˜ ì¼ë¶€ë¶„ë§Œ ë³€ê²½
    - ê¸°ì¡´ -> ì„œë²„ ìš”ì²­, ëŒ€ê¸°, ì „ì²´í™”ë©´ ìƒˆë¡œê³ ì¹¨
    - AJAX -> ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•œ ë¶€ë¶„ë§Œ ë³€ê²½.

* ì„œë²„ì™€ í†µì‹ ì„ í•˜ê¸° ìœ„í•˜ì—¬ XMLHttpRequest ê°ì²´ë¥¼ í™œìš©.

* JSON, XML, HTML ê·¸ë¦¬ê³  ì¼ë°˜ í…ìŠ¤íŠ¸ í˜•ì‹ë“±ì„ í¬í•œí•œ ë‹¤í–¥í•œ í¬ë§·ì„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆìŒ.

* í˜ì´ì§€ ì „ì²´ë¥¼ "ìƒˆë¡œê³ ì¹¨" í•˜ì§€ ì•Šê³ ì„œë„ ìˆ˜í–‰ë˜ëŠ” "ë¹„ë™ê¸°ì„±"(ì¼ ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸ ê°€ëŠ¥)

## ë™ì‘ë°©ì‹

![DOM](/Image/java_script/ajax.png)


* êµ¬ ) ì„œë²„ì— ìš”ì²­í•œ ë°ì´í„°ê°€ ë„ì°©í•  ë•Œê¹Œì§€ í´ë¼ì´ì–¸íŠ¸ëŠ” ëŒ€ê¸°

* ì‹  ) ì„œë²„ì— ìš”ì²­í•œ ë°ì´í„°ê°€ ë„ì°©í•  ë™ì•ˆ í´ë¼ì´ì–¸íŠ¸ëŠ” ë©ˆì¶”ì§€ ì•Šê³  ë™ì‘.



## ì‚¬ìš©ë°©ë²•

* XMLHttpRequest ê°ì²´
    - ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´
    - ì„œë²„ì™€ ìƒí˜¸ì‘ìš©ì„ í•˜ê¸° ìœ„í•´ ì‚¬ìš©.
    - ì „ì²´ í˜ì´ì§€ì˜ ìƒˆë¡œê³ ì¹¨ ì—†ì´ë„ URLë¡œ ë¶€í„° ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŒ.
    - ì‚¬ìš©ìì˜ ì‘ì—…ì„ ë°©í•´í•˜ì§€ ì•Šê³  í˜ì´ì§€ì˜ ì¼ë¶€ë¥¼  ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŒ.
    - AJAX í”„ë¡œê·¸ë˜ë°ì— ì£¼ë¡œ ì‚¬ìš©.
    - XMLì´ë¼ëŠ” ì´ë¦„ê³¼ëŠ” ë‹¬ë¦¬ ëª¨ë“  ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ”ë° ì‚¬ìš© ê°€ëŠ¥.
    - ëŒ€ë¶€ë¶„ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›
        - Firefox, Opera, Safari..
    - í‘œì¤€ HTTP ë°©ì‹(GET/ POST)ìœ¼ë¡œ ì„œë²„ì™€ í†µì‹ 
    - http ì´ì™¸ì˜ í”„ë¡œí† ì½œë„ ì§€ì›(file, ftp í¬í•¨)
    - ì„œë²„ì™€ í†µì‹ ì‹œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ì—…
        - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—….


### Methods

* open("HTTP method", "URL", sync/async)
    - open("GET/POST", "ìš”ì²­ì„ ë³´ë‚¼ url", "async(default)")
    - ìš”ì²­ì˜ ì´ˆê¸°í™” ì‘ì—…
    - GET/POST ì§€ì •
      - GET : ì£¼ì†Œ URLì˜ íŒŒë¼ë¯¸í„°ê°€ ë…¸ì¶œë˜ë¯€ë¡œ, ë…¸ì¶œì‹œì¼œë„ ë˜ëŠ” ì •ë³´ë§Œ ë‹´ì•„ ë³´ë‚¸ë‹¤. -> ê¸¸ì´ì˜ ì œí•œì´ ì¡´ì¬.
      - POST : HTTP bodyì— ë‚´ìš©ì´ ë‹´ì•„ì ¸ì„œ ë³´ë‚´ì§€ê¸° ë•Œë¬¸ì— íŒŒë¼ë¯¸í„°ê°€ ë…¸ì¶œì´ ë˜ì§€ ì•ŠìŒ.
      - ë‘ ë°©ì‹ ëª¨ë‘ key/valueì˜ ë°©ì‹ìœ¼ë¡œ ì „ë‹¬ë¨.
    - ì„œë²„ URL ì§€ì •
    - ë™ê¸°/ ë¹„ë™ê¸° ì„¤ì •
  
* send(content)
    - GETë°©ì‹ì€ URLì— í•„ìš” ì •ë³´ë¥¼ ì¶”ê°€í•˜ê¸° ë•Œë¬¸ì— null ì ìš©.
    - POSTë°©ì‹ì—ì„œ íŒŒë¼ë¯¸í„° ì„¤ì • ì²˜ë¦¬.

### XMLHttpRequest Properties

* onreadystatechange
    - ì„œë²„ì—ì„œ ì‘ë‹µì´ ë„ì°©í–ˆì„ ë•Œ, í˜¸ì¶œë  ì½œë°±í•¨ìˆ˜ ì§€ì •.
    - ì½œë°±í•¨ìˆ˜ëŠ” ìƒíƒœ(readyState)ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í˜¸ì¶œ.


* readyState
    - 0 : uninitialized(ê°ì²´ ìƒì„± í›„ open ë§¤ì„œë“œ í˜¸ì¶œ ì „)
    - 1 : loading(open ë§¤ì„œë“œê°€ í˜¸ì¶œë˜ê³  send í˜¸ì¶œ ì „)
    - 2 : loaded(send ë§¤ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆì§€ë§Œ, ì„œë²„ ì‘ë‹µ ì „)
    - 3 : interactive(ë°ì´í„° ì¼ë¶€ê°€ ì „ì†¡ëœ ìƒíƒœ)
    - 4 : completed (ëª¨ë“  ë°ì´í„° ì „ì†¡ ì™„ë£Œ)

* status
  -  ì„œë²„ ì²˜ë¦¬ ê²°ê³¼ ìƒíƒœ ì½”ë“œ
  -  200 -> OK(ìš”ì²­ ì„±ê³µ)
  -  404 -> Not Found(í˜ì´ì§€ë¥¼ ëª» ì°¾ì„ ê²½ìš° - client ì‹¤ìˆ˜)
  -  500 -> Server Error(ì„œë²„ì—ì„œ ê²°ê³¼ ìƒì„±ì‹œ ì˜¤ë¥˜ ë°œìƒ - ê°œë°œì ì‹¤ìˆ˜)

* response Text
    - ì„œë²„ì˜ ì‘ë‹µê²°ê³¼ë¥¼ ë¬¸ìì—´ë¡œ ë°›ê¸°

* responseXML
    - ì„œë²„ì˜ ì‘ë‹µê²°ê³¼ë¥¼ XML Documentë¡œ ë°›ê¸°


## ì„œë²„ì²˜ë¦¬

* ê¸°ì¡´ ì„œë²„ ì‘ì—… ë°©ì‹ ì‚¬ìš© (Servlet, JSP ...)
* ì‘ë‹µ ë¬¸ì„œ íƒ€ì…
    - ê¸°ì¡´ html ì™¸ì— xml, json, ë‹¨ìˆœ í…ìŠ¤íŠ¸ ì‚¬ìš©.


## AJAX í”„ë¡œê·¸ë˜ë° ìˆœì„œ

1. í´ë¼ì´ì–¸íŠ¸ ì´ë²¤íŠ¸ ë°œìƒ.
    - í´ë¦­, í˜ì´ì§€ ë¡œë”© ë“±...
2. XMLHttpRequest ê°ì²´ ìƒì„±.
3. XMLHttpRequest ê°ì²´ ì½œë°±í•¨ìˆ˜ ì„¤ì •.
4. XMLHttpRequest ê°ì²´ë¥¼ í†µí•œ ë¹„ë™ê¸°í™” ìš”ì²­
5. ì„œë²„ ì‘ë‹µê²°ê³¼ë¥¼ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡.
6. XMLHttpRequest ê°ì²´ëŠ” ì„œë²„ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•  ì½œë°±í•¨ìˆ˜ í˜¸ì¶œ
7. ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ í™”ë©´ì— ë°˜ì˜.


## ì°¸ê³ > javascriptëŠ” single thread

* ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” call stackì´ í•˜ë‚˜.
* ì¦‰ì‹œ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ì´ë²¤íŠ¸ë“¤ì„ (Web API)ë¡œ ë³´ë‚´ì„œ ì²˜ë¦¬
* ì²˜ë¦¬ëœ ì´ë²¤íŠ¸ë“¤ì€ ì²˜ë¦¬ëœ ìˆœì„œëŒ€ë¡œ (Task queue)ì— ì €ì¥.
* Call Stackì´ ê³µë°±ì´ ë˜ë©´ (Event Loop) ê°€ ëŒ€ê¸° ì¤„ì—ì„œ ê°€ì¥ ì˜¤ë˜ëœ ì´ë²¤íŠ¸ë¥¼ Call Stack ìœ¼ë¡œ ë³´ëƒ„.


## ìˆœì°¨ì ì¸ ë¹„ë™ê¸° ì²˜ë¦¬í•˜ê¸°

> web apië¡œ ë“¤ì–´ì˜¤ëŠ” ìˆœì„œëŠ” ì¤‘ìš”ë¼ì§€ ì•Šê³ , ì–´ë–¤ ì´ë²¤íŠ¸ê°€ ë¨¼ì € ì²˜ë¦¬ë˜ëŠëƒê°€ ì¤‘ìš”.(ì‹¤í–‰ ìˆœì„œ ë¶ˆëª…í™•)

### Async Callbacks

* ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ì„ ì‹œì‘í•  í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì¸ìë¡œ ì§€ì •.

* ex) addEventListener()ì˜ ë‘ë²ˆì§¸ ì¸ì

### Promise-Style

* Modern Web APIsì—ì„œì˜ ìƒˆë¡œìš´ ì½”ë“œ ìŠ¤íƒ€ì¼ 

* XMLHttpRequest ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ë³´ë‹¤ ì¡°ê¸ˆ ë” í˜„ëŒ€ì ì¸ ë²„ì ¼.


<br>
<br>
<br>
<br>
<br>
<br>

ğŸš€ ì‚¬ìš©ì˜ˆì‹œ ì½”ë“œ ğŸš€

> txtíŒŒì¼ì„ ì½ì–´ì˜¬ ë•Œ

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Text íŒŒì¼ ì´ìš©</title>
  </head>
  <body>
    <h1>ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€</h1>
    <div id="msg-view"></div>
    <button id="get-data">ìš”ì²­</button>

    <script>
      let xhr; //ê»ë°ê¸° ì¤€ë¹„

      //1. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­ì´ ë°œìƒí•´ì•¼í•œë‹¤.
      document.querySelector('#get-data').addEventListener('click', () => {
        // AJAX ìš”ì²­ê³¼ ì‘ë‹µ ì²˜ë¦¬ë¥¼ ì§„í–‰í•  XMLHttpRequest ê°ì²´ ìƒì„±ì í•¨ìˆ˜ í˜¸ì¶œ
        xhr = new XMLHttpRequest();
        // xhrì˜ ìƒíƒœê°€ ë°”ë€” ë•Œ ë§ˆë‹¤ í˜¸ì¶œí•  ì½œë°±í•¨ìˆ˜ë¥¼ ë“±ë¡í•˜ê² ë‹¤.
        xhr.onreadystatechange = responseMsg;

        //ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚¼ê±°ì—ìš”.
        //open("ìš”ì²­ë°©ì‹", "URL(ì–´ë””ë‹¤ê°€ ì–´ë–¤ ìš”ì²­ì„ ë³´ë‚¼ê±´ì§€)", ["ë¹„ë™ê¸°ë°©ì‹ì˜ ì—¬ë¶€"])
        xhr.open('GET', './data/hello.txt', true);

        //ìš”ì²­ë³´ë‚´ê¸°
        xhr.send();
      });

      //AJAX ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì´ ì™”ì„ë•Œ ì‚¬ìš©í•  ì½œë°±í•¨ìˆ˜
      function responseMsg() {
        console.log(xhr);
        //ì„œë²„ì˜ ì‘ë‹µì´ ì™„ë²½í•˜ê²Œ ëë‚¬ì„ë•Œ
        if (xhr.readyState == 4) {
          //ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ì—†ì´ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë¬ì„ë•Œ
          if (xhr.status == 200) {
            // console.log(xhr)
            document.querySelector('#msg-view').innerHTML = xhr.responseText;
          } else {
            console.log('ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•˜ì§€ ëª»í–ˆë‹¤.');
          }
        }
      }
    </script>
  </body>
</html>
```

> jsoníŒŒì¼ì„ ì½ì–´ì˜¬ ë•Œ.

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>JSON íŒŒì¼ ì´ìš©</title>
  </head>

  <body>
    <h1>JSON íŒŒì¼ì„ ì½ì–´ ë©¤ë²„ë¥¼ í˜¸ì¶œí•´ë³´ì</h1>
    <textarea id="student" cols="30" rows="10"></textarea>
    <input type="button" value="ì¶œì„" onclick="requestMsg()" />
    <script>
      //ê»ë°ê¸°
      let xhr;
      //textarea íƒœê·¸ë¥¼ ê°€ì§€ê³  ì™”ë‹¤.
      let studentArea = document.getElementById('student');

      function requestMsg() {
        xhr = new XMLHttpRequest();
        xhr.onreadystatechange = callbackFunc;
        xhr.open('GET', './data/member.json');
        xhr.send();
      }

      function callbackFunc() {
        //ì™„ë²½í•˜ê²Œ í†µì‹ ì´ ëë‚¬ì„ë•Œ
        if (xhr.readyState == 4) {
          //OK
          if (xhr.status == 200) {
            //JSON íŒŒì¼ì„ ì½ì–´ì™”ë”°. (ì–˜ëŠ” ì–´ì°¨í”¼ ë¬¸ìì—´~~)
            let stList = JSON.parse(xhr.response);
            console.log(stList);
            studentArea.value += 'ì´í•™ìƒìˆ˜ : ' + stList.length + 'ëª…\n';
            for (let i = 0; i < stList.length; i++) {
              let st = stList[i];
              studentArea.value += `id : ${st.id}\nname : ${st.name}\n`;
            }
          }
        }
      }
    </script>
  </body>
</html>


```
 
















































