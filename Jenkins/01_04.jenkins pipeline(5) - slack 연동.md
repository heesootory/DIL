# jenkins pipeline - slack ì—°ë™


<br>
<br>
<br>

## ğŸŒˆ Slack ì„¤ì •

<br>
<br>

### ğŸ³ jenkins ì•± ì„¤ì¹˜

<br>

### ğŸ³ slack token ìƒì„±.

* 1. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±

* 2. Slack ì°¾ì•„ë³´ê¸° > ì•± > jenkins ê²€ìƒ‰ > ì¶”ê°€

<img 
    src = "../Image/jenkins/44.png"
    width = 600px
    height = 350px   
/>

* 3. í•´ë‹¹ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒ

<img 
    src = "../Image/jenkins/45.png"
    width = 550px
    height = 350px   
/>

* 4. ì„¤ì • ì§€ì¹¨ ë°©ë²•ì´ ë‚˜ì˜¤ëŠ”ë° -> ê°€ì¥ í•˜ë‹¨ì— í† í° ë³µì‚¬.

<img 
    src = "../Image/jenkins/46.png"
    width = 550px
    height = 350px   
/>
<img 
    src = "../Image/jenkins/47.png"
    width = 550px
    height = 350px   
/>



## ğŸŒˆ jenkins ì„¤ì •

<br>

<br>

### ğŸ³ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

> "Slack Notification" í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜.

<br>


### ğŸ³ slack credentials ë“±ë¡

* kind : Secret text
* Scope : Global
* Secret : Slackì—ì„œ ì–»ì€ í† í°
* ID : pipelineì—ì„œ êµ¬ë³„í•  alias (ì•„ë¬´ê±°ë‚˜ ê°€ëŠ¥)

<br>
<br>

### ğŸ³ jenkins ì‹œìŠ¤í…œ ì„¤ì •

> Jenkins ëŒ€ì‹œë³´ë“œ > Jenkins ê´€ë¦¬ > ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ Slack ì˜ì—­ì„ ì„¤ì •

<img 
    src = "../Image/jenkins/48.png"
    width = 550px
    height = 350px   
/>

* workspace : ğŸ”¥ ë‚´ê°€ ìƒì„±í•  ë•Œ ì ì€ workspace ëª…ì´ ì•„ë‹ˆë¼, urlë¡œ ë°”ê¼ˆì„ë•Œ ê°€ìš´ë° ë¶€ë¶„ì— ë“¤ì–´ê°€ëŠ” ì´ë¦„ì„ ì ê¸°!!

* credentials : ë“±ë¡í•œ slack_key ë“±ë¡.

* default channel/member id : ì•Œë¦¼ ë°›ì„ ì±„ë„ëª….

* test Connection! ->  success ì‹œ, slackì— ì•Œë¦¼ì˜´!

    <img 
        src = "../Image/jenkins/49.png"
        width = 550px
        height = 350px   
    />


### ğŸ³ pipeline script - ì™„ì„±ë³¸

```groovy
pipeline {
    agent any
    
    environment {
        imagename = "heesootory/jenkins_pipe"
        registryCredential = 'docker_hub'
        dockerImage = ''
        containerName = 'spring'
        noneFile = '"dangling=true"'
    }

    stages {
        stage('Git Clone ğŸ¦Š') {
            steps {
                git url: 'https://github.com/heesootory/jenkins_pipe_test.git',
                    branch: 'main',
                    credentialsId: 'github_token'
            }
        }
        
        stage('Bulid Gradle ğŸ€') {
            steps {
                echo 'Bulid Gradle'
                dir('.'){
                    sh './gradlew clean build'
                }
            }
        }
        
        stage('Bulid Docker ğŸ³') {
            steps {
                echo 'Bulid Docker'
                script {
                    dockerImage = docker.build imagename
                }
            }
        }

        stage('Push Docker ğŸš€') {
            steps {
                echo 'Push Docker'
                script {
                    docker.withRegistry( '', registryCredential) {
                        dockerImage.push() 
                    }
                }
            }
        }
        
        stage('Docker Run ğŸŒ»') {
            steps {
                echo 'Pull Docker Image & Docker Image Run'
                sshagent (credentials: ['ssh_key']) {
                    sh "ssh -o StrictHostKeyChecking=no ubuntu@43.200.252.25 'docker pull ${imagename}'" 
                    sh "ssh -o StrictHostKeyChecking=no ubuntu@43.200.252.25 'docker ps -q --filter name=${containerName} | grep -q . && docker rm -f \$(docker ps -aq --filter name=${containerName})'"
                    sh "ssh -o StrictHostKeyChecking=no ubuntu@43.200.252.25 'docker run -d --name ${containerName} -p 8080:8080 ${imagename}'"
                    sh "ssh -o StrictHostKeyChecking=no ubuntu@43.200.252.25 'docker rmi -f \$(docker images --filter ${noneFile} -q)'"
                }
            }
        }
    }
    
    post{
        success {
            slackSend (channel: 'jenkins_test2', color: '#00FF00', message: "SUCCESSFUL: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})")
        }
        failure {
            slackSend (channel: 'jenkins_test2', color: '#FF0000', message: "FAILED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})")
        }
    }
}
```


<br>
<br>
<br>
<br>

> ì™„ë£Œëœ jenkins stage view

<img 
    src = "../Image/jenkins/51.png"
    width = 600px
    height = 400px   
/>