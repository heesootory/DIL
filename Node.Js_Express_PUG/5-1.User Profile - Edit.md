# User Profile


<br>

## index



<!-- TOC -->

- [User Profile](#user-profile)
  - [index](#index)
  - [Edit Profile1](#edit-profile1)
  - [Protector and Public Middlewares](#protector-and-public-middlewares)
    - [controller ì— middleware ì¶”ê°€ë¡œ ë³´ì•ˆ up!](#controller-ì—-middleware-ì¶”ê°€ë¡œ-ë³´ì•ˆ-up)
  - [Edit Profile2](#edit-profile2)
    - [controller - DB ìˆ˜ì •](#controller---db-ìˆ˜ì •)

<!-- /TOC -->



<br>



---


<br>


## Edit Profile1

* edit Controller & Router

![d](/Image/Express/e1.PNG)
![d](/Image/Express/e2.PNG)

* view - base

![d](/Image/Express/e3.PNG)


* view - edit-profile

![d](/Image/Express/e4.PNG)
![d](/Image/Express/e5.PNG)

> localì— ì €ì¥ëœ ì •ë³´ëŠ” viewíŒŒì¼ì–´ë””ì—ì„œë“  ì‚¬ìš©ê°€ëŠ¥!!


* middleware

![d](/Image/Express/e7.PNG)

> ë¹ˆ ê°ì²´ë„ localì— ì €ì¥í•  ìˆ˜ ìˆê²Œ í•´ì„œ, ë¹„ë¡œê·¸ì¸ì‹œì— urlë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ.
<br>
> ì´ê±¸ ìˆ˜ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì¼ë‹¨ ë“¤ì–´ê°€ê²Œ ì„¤ì •í•´ë³¸ë‹¤.

![d](/Image/Express/e6.PNG)

> ë¡œê·¸ì¸ì´ ë˜ìˆì§€ ì•Šì€ ìƒíƒœì—ë„, urlë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ”ë°, ìˆ˜ì •í•´ì•¼í•  ë¶€ë¶„!




## Protector and Public Middlewares

> ë¹„ë¡œê·¸ì¸ìë“¤ì´ edití˜ì´ì§€ì— ë¬´ë‹¨ìœ¼ë¡œ urlì„ í†µí•´ ë“¤ì–´ì˜¤ëŠ” ê±¸ ë§‰ì•„ë³´ì.

![d](/Image/Express/e8.PNG)

* protectordMiddleware
> ë¡œê·¸ì¸ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¯¸ë“¤ì›¨ì–´. <br>
> ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´, í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸.

* publicOnlyMiddleware
> ë¹„ë¡œê·¸ì¸ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¯¸ë“¤ì›¨ì–´. ë¡œê·¸ì¸ ë˜ì–´ìˆë‹¤ë©´, í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸.

### controller ì— middleware ì¶”ê°€ë¡œ ë³´ì•ˆ up!

![d](/Image/Express/e9.PNG)
![d](/Image/Express/e10.PNG)

* all()
> ì–´ë–¤ http methodì—ë„ ì ìš©ì‹œí‚¤ëŠ” í•¨ìˆ˜.

>> ì¶”í›„ì— video modelê³¼ user modelì´ í•©ì³ì§€ëŠ” ìƒí™©ì´ ì˜¤ëŠ”ë°, ê·¸ë•Œë¥¼ ìœ„í•´ì„œ, video controllerì—ë„ ì¶”ê°€ì‹œì¼œì£¼ì.

![d](/Image/Express/e11.PNG)
![d](/Image/Express/e12.PNG)



## Edit Profile2

### controller - DB ìˆ˜ì •

* req.query -> get ì •ë³´
* req.body -> post ì •ë³´
* req.session -> req.object(user = ìš°ë¦¬ê°€ ì§‘ì–´ ë„£ì€ ê°ì²´)

* ES6

```js
const {
        session: {
            user: {id},
        },
    } = req;
```
```js
const i = req.session.user.id;
```
> ìœ„ì˜ ë‘ ë°©ì‹ì€ ë™ì¼.

> ë‹¤ë¥¸ ë³€ìˆ˜ë“¤ë„ ë‹¤ë¥¸ìƒí™©ì—ì„œ ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, 1ë²ˆì˜ ë°©ì‹ì´ ì„ í˜¸.

![d](/Image/Express/e13.PNG)

> req.ì—ì„œ í•„ìš”í•œ ë³€ìˆ˜ë¥¼ ë‘ë¬¸ì¥ìœ¼ë¡œ ë”°ë¡œ ê°€ì ¸ì˜¤ëŠ”ê±¸(ì£¼ì„ëœ ë¬¸ì¥) -> ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

![d](/Image/Express/e14.PNG)

> ìˆ˜ì •ì™„ë£Œ!!


### ë³€ê²½ëœ ìˆ˜ì • ì‚¬í•­ì´ ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œ!


![d](/Image/Express/e15.PNG)

> ìˆ˜ì •ì„ í•˜ê³  ë³€ê²½ì„ í•´ë„, ìˆ˜ì •ì‚¬í•­ì´ edit-profileí˜ì´ì§€ì— ë°˜ì˜ì´ ì•ˆë˜ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

![d](/Image/Express/e16.PNG)

â„ï¸ ì—¬ê¸°ì„œ ì´ìƒí•œì ì€ , dbì—ëŠ” ìˆ˜ì •ì´ ë˜ì–´ ìˆë‹¤!!
-> í”„ë¡ íŠ¸ì—”ë“œì—ë§Œ ë°˜ì˜ë˜ì§€ ëª»í–ˆë‹¤!!

ğŸ”¥ ì›ì¸ì€ sessionì •ë³´ì— ìˆë‹¤!!!

![d](/Image/Express/e17.PNG)

> ë³´ë‹¤ì‹œí”¼, edit-profileí˜ì´ì§€ì—ì„œëŠ” í˜„ì¬ ë¡œê·¸ì¸í•œ userì˜ ì„¸ì…˜ì •ë³´ì— ì €ì¥ë˜ì–´ ìˆëŠ” ì •ë³´ë¥¼ ë³´ì—¬ì£¼ê³  ìˆëŠ”ë°, sessionì •ë³´ëŠ” ì²« ë¡œê·¸ì¸ì‹œ userì˜ ì •ë³´ê°€ ì €ì¥ë˜ê³ , localì—ë„ ì €ì¥ëœë‹¤. ë”°ë¼ì„œ, ì§€ê¸ˆ ìˆ˜ì •ëœ ì‚¬í•­ì´ sessionì—ëŠ” ìˆ˜ì •ë˜ì§€ ì•Šì€ ìƒíƒœì´ë‹¤.


### session Update

#### ì§ì ‘ ë°”ê¾¸ëŠ” ë°©ì‹

![d](/Image/Express/e18.PNG)

> sessionì •ë³´ë„ ìˆ˜ì •.

* ...req.session.user,

> ì´ê±´ userê°ì²´ì˜ ì•ˆì— ìˆëŠ” ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤ëŠ” ë¬¸ë²•ì´ë‹¤.

> ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³ , ê·¸ ë’¤ì— ìˆ˜ì •í•  ì†ì„±ì„ ì ì–´ì£¼ë¯€ë¡œ, ë®ì–´ì“°ëŠ” íš¨ê³¼ê°€ ëœë‹¤.


#### ìƒˆë¡œìš´ ê°ì²´ë¡œ ë°”ê¾¸ëŠ” ë°©ì‹

[https://mongoosejs.com/docs/api.html#model_Model.findByIdAndUpdate](https://mongoosejs.com/docs/api.html#model_Model.findByIdAndUpdate)

> findByIdAndUpdateëŠ” ì„¸ë²ˆì§¸ ì¸ìë¡œ, new:trueë¥¼ ë„£ì–´ì¤˜ì•¼ë§Œ, ìƒˆë¡­ê²Œ ìˆ˜ì •ëœ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
