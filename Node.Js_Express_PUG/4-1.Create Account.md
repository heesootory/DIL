# USER AUTHENTICATION

<br>

## index

<!-- TOC -->

- [USER AUTHENTICATION](#user-authentication)
  - [index](#index)
  - [Create Account](#create-account)
  - [password hashing(ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ)](#password-hashingë¹„ë°€ë²ˆí˜¸-ë³´ì•ˆ)
    - [bcrypt ì‚¬ìš©](#bcrypt-ì‚¬ìš©)
  - [user Controller ìˆ˜ì •](#user-controller-ìˆ˜ì •)
    - [or (ì •ê·œ í‘œí˜„ì‹)](#or-ì •ê·œ-í‘œí˜„ì‹)
    - [password2 - í™•ì¸ìš©](#password2---í™•ì¸ìš©)
  - [status code(ìƒíƒœ ì½”ë“œ)](#status-codeìƒíƒœ-ì½”ë“œ)

<!-- /TOC -->

<br>



---



<br>



## Create Account

> DBì— ìœ ì €ë¡œ ë“±ë¡ì´ ë˜ëŠ” ê³¼ì •ì„ ë§Œë“¤ì–´ë³´ì.

![d](/Image/Express/u1.PNG)
> videoë¥¼ ë§Œë“¤ì—ˆë˜ê²ƒê³¼ ìœ ì‚¬!

![d](/Image/Express/u2.PNG)
> user ëª¨ë¸ ê¸°ë³¸í‹€ë§Œ ì™„ì„±.

![d](/Image/Express/u3.PNG)
> init.jsì—ì„œ import.

![d](/Image/Express/u4.PNG)
> ëª¨ë¸ ìŠ¤í‚¤ë§ˆ ì •ì˜.

![d](/Image/Express/u5.PNG)
> create Account í˜ì´ì§€ ìƒì„±. controller ì„¤ì •.

![d](/Image/Express/u6.PNG)
> ì´ë¦„ì´ ì¡°ê¸ˆ ë¶ˆë¶„ëª…í•œ globalRouter -> rootRouter

![d](/Image/Express/u7.PNG)
> baseí˜ì´ì§€ì— ë¡œê·¸ì¸ ë§í¬ ì¶”ê°€.

![d](/Image/Express/u8.PNG)
> ë‹¤ì‹œ joinìœ¼ë¡œ ë³€ê²½..--;

![d](/Image/Express/u10.PNG)
![d](/Image/Express/u9.PNG)
> getê³¼ post controllerìƒì„±, Routerì— ì„¤ì •.

![d](/Image/Express/u11.PNG)
> join í˜ì´ì§€ ì™„ì„±.

![d](/Image/Express/u12.PNG)
> ì—¬ê¸°ê¹Œì§€ POST ì •ìƒ ì‘ë™ í™•ì¸.


![d](/Image/Express/u13.PNG)
> POST ë‚´ìš© DBë¡œ ì „ë‹¬, ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ loginí˜ì´ì§€ë¡œ ì´ë™.

![d](/Image/Express/u14.PNG)
> DBë¡œ ë“¤ì–´ê°„ê²ƒ í™•ì¸!

> but!!! passwordê°€ ìˆ«ì ê·¸ëŒ€ë¡œ ë“¤ì–´ê°„ê²ƒì„ ë³¼ ìˆ˜ìˆëŠ”ë°, ë³´ì•ˆì— ë§¤ìš° ì·¨ì•…í•´ ì§„ë‹¤.



## password hashing(ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ)

> DBì—ë„ PASSWORDëŠ” ì•”í˜¸í™”í•´ì•¼í•œë‹¤. DBë¥¼ í•´í‚¹ ë‹¹í–ˆì„ë•Œ, ê·¸ passwordë¡œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë” í°ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

* í•´ì‹±ì€ ì¼ë°©í–¥ í•¨ìˆ˜ -> ë¬¸ìì—´ë¡œ ë°”ê¿”ì£¼ëŠ” í•¨ìˆ˜ê°€ í•„ìš”, ì ˆëŒ€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ë˜ëŒë¦´ ìˆ˜ê°€ ì—†ë‹¤.

* ì…ë ¥ê°’ì€ í•­ìƒ ê°™ì€ ì¶œë ¥ê°’ì„ ê°€ì§€ê²Œ ë˜ê³ , ì¶œë ¥ê°’ìœ¼ë¡œëŠ” ì ˆëŒ€ ì…ë ¥ê°’ì„ ë§Œë“¤ ìˆ˜ ì—†ë‹¤.

* ì´ëŸ¬í•œ í•¨ìˆ˜ë¥¼ <mark>deterministic function(ê²°ì •ì  í•¨ìˆ˜)</mark>ë¼ê³  í•œë‹¤.


![d](/Image/Express/u15.PNG)
> db ì €ì¥ëœ ë°ì´í„° ëª¨ë‘ ì§€ìš°ê³  ë‹¤ì‹œ ë§Œë“¤ì–´ë³´ê¸°.


### bcrypt ì‚¬ìš©

> ì´ê²Œ ìš°ë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹±í•´ì¤Œ.

[https://www.npmjs.com/package/bcrypt](https://www.npmjs.com/package/bcrypt)

```bash
npm i bcrypt
```
> ì„¤ì¹˜.

cf > rainbow table : í•´ì‹±ëœ ì•”í˜¸ë¥¼ ì´ìš©í•´ì„œ í•´ì»¤ë“¤ì´ ê³µê²©í•˜ëŠ” í•´í‚¹ í˜•íƒœ.
-> ìœ íˆ¬ë¸Œ í™•ì¸í•´ë³´ê¸°.


> bcryptê°€ rainbow tableê³µê²©ì„ ë§‰ì•„ì¤„ ìˆ˜ ìˆë‹¤.

![d](/Image/Express/u16.PNG)

> ê³µì‹ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì¸ìš©í•  ê²ƒì´ë‹¤.

> ë§¤ê°œë³€ìˆ˜ ì¤‘ saltRoundsëŠ” ëª‡ë²ˆ í•´ì‹±ì„ í•  ì§€ ê²°ì •í•œë‹¤. -> ë§ì„ ìˆ˜ë¡ ë” ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•´ì§.

![d](/Image/Express/u17.PNG)

>  ì•”í˜¸í™” í•¨ìˆ˜ë¥¼ pre('save') í˜•íƒœë¡œ ìë™í™”ë˜ê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤.
> -> ì—¬ê¸°ì„œ this.passwordëŠ” ë‹¹ì—¬ë‹£ ìƒì„±ë˜ëŠ” ê°ì²´ë¥¼ ëœ»í•œë‹¤. ë”°ë¼ì„œ, Userì´ í•˜ë‚˜ ë§Œë“¤ì–´ ì§ˆë•Œë§ˆë‹¤, ê°ê°ì˜ ì‚¬ìš©ìê°€ thisì¸ ê²ƒì´ë‹¤.
> -> pre('save') í˜•íƒœì´ë¯€ë¡œ, dbì— ì €ì¥ë˜ê¸° ì „ì— ë¨¼ì € ìˆ˜í–‰ë˜ê³ , Userê°ì²´ê°€ ë§Œë“¤ì–´ì§€ê¸°ë„ ì „ì— ìˆ˜í–‰ëœë‹¤.

![d](/Image/Express/u18.PNG)
![d](/Image/Express/u19.PNG)



## user Controller ìˆ˜ì •

> ê³„ì •ì´ ì¤‘ë³µë˜ì§€ ì•Šê²Œ í™•ì¸í•˜ëŠ” ê³¼ì • ë„£ê¸°.

> schemaë¥¼ ì§¤ë•Œ, emailì´ë‚˜ usernameì´ unique: true ë¡œ ì„¤ì •í–ˆì§€ë§Œ, ì¤‘ë³µí‚¤ê°€ ë°œìƒí–ˆì„ë•Œ, dbì—ì„œë§Œ ì—ëŸ¬ê°€ ë‚˜ê³ , ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì£¼ì§ˆ ì•Šìœ¼ë©´ ë¬¸ì œê°€ ëœë‹¤.

> ìš°ë¦¬ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ê·¸ê±¸, dbì— ì €ì¥í•˜ê¸°ì „ì— catchí•´ì•¼ í•œë‹¤.
> -> dbì—ì„œëŠ” ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šê²Œ í•´ì•¼í•¨!


![d](/Image/Express/u20.PNG)
![d](/Image/Express/u21.PNG)
![d](/Image/Express/u22.PNG)

> username ì¡´ì¬ì—¬ë¶€ í™•ì¸í•´ì„œ, ì—ëŸ¬ë©”ì„¸ì§€ ë„ìš°ê¸°
> emailë„ ë™ì¼í•˜ê²Œ í™•ì¸.

### or (ì •ê·œ í‘œí˜„ì‹)

[https://www.mongodb.com/docs/manual/reference/operator/query/or/](https://www.mongodb.com/docs/manual/reference/operator/query/or/)

![d](/Image/Express/u23.PNG)

> orë¡œ ë‘ í™•ì¸/ê²€ì¦ì„ í•œë²ˆì— ì²˜ë¦¬.


### password2 - í™•ì¸ìš©

![d](/Image/Express/u24.PNG)
![d](/Image/Express/u25.PNG)


## status code(ìƒíƒœ ì½”ë“œ)

![d](/Image/Express/u26.PNG)
![d](/Image/Express/u27.PNG)
> í˜„ì¬ ì—ëŸ¬ë©”ì„¸ì§€ê°€ ëœ¨ëŠ”ë°ë„ ë¶ˆêµ¬í•˜ê³ , id/passwordë¥¼ ì €ì¥í•  ê²ƒì´ëƒê³  ë¬¼ì–´ë³´ëŠ”ê²Œ ì˜ëª»ë˜ì—ˆë‹¤.

> ì´ë•Œ, consoleì°½ì„ ë³´ë©´, status codeê°€ 200(ì„±ê³µ)ìœ¼ë¡œ ëœ¨ëŠ”ë°, ìƒíƒœì½”ë“œê°€ ì„±ê³µìœ¼ë¡œ ë‚˜ì™€ì„œ, ë¸Œë¼ìš°ì ¸ê°€ ìë™ìœ¼ë¡œ ì¸ì‹í•´, ì €ì¥ ì—¬ë¶€ë¥¼ ë¬¼ì–´ë³´ëŠ” ê²ƒ.

> ìš°ë¦¬ëŠ” 400(ì‹¤íŒ¨ì½”ë“œ) - Bad request ë¥¼ ë³´ë‚´ì¤˜ì•¼ í•œë‹¤.

![d](/Image/Express/u28.PNG)

> ì—ëŸ¬ë‚˜ëŠ” ê³³ì€ 400ìœ¼ë¡œ, not foundë„ 404ì „ë‹¬í•´ì£¼ì.

â„ï¸ 200ì´ë“  400ì´ë˜ 404ë˜ ì¤‘ìš”í•œê±´ê°€???

ğŸ”¥ ë¸Œë¼ìš°ì €ëŠ” ìš°ë¦¬ê°€ ìƒíƒœì½”ë“œ ì—†ì´ ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ëŠ” ê²ƒì„ ì „í˜€ ì•Œì§€ ëª»í•œë‹¤.
ë”°ë¼ì„œ, ìƒíƒœì½”ë“œë¥¼ ì•Œë ¤ì¤˜ì•¼ë§Œ, 200ì—ì„œëŠ” ìœ ì €ê°€ ì…ì¶œì…í•œ íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•˜ê³ , 404ì¼ë•ŒëŠ” ì €ì¥ì„ ì•ˆí•˜ëŠ” ë“± ê¸°ë¡ì„ ìˆ˜í–‰í•œë‹¤.
ì´ëŸ¬í•œ ìˆ˜í–‰ì´ ì •í™•í•´ì•¼, ìœ ì €ì—ê²Œë„ ë” í¸í•˜ë‹¤.

![d](/Image/Express/u29.PNG)



![d](/Image/Express/u30.PNG)

>ë§ˆì§€ë§‰ìœ¼ë¡œ, ìœ ì €ë¥¼ ìƒì„±í•˜ëŠ” ê³³ë„ try~catchë¬¸ìœ¼ë¡œ ë” ì•ˆì „í•˜ê²Œ ê°ì‹¸ì£¼ê¸°.
-> í˜¹ì‹œ ëª¨ë¥¼ errorë¥¼ ìœ„í•´ì„œ.




