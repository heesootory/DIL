# Comment section

<br>

## index

<br>



---

<br>




## Schema (DB model)

![api](/Image/Express/a1.png)
![api](/Image/Express/a2.png)
![api](/Image/Express/a3.png)

> video, user modelì€ ì—¬ëŸ¬ê°œì˜ commentë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë°°ì—´[]ë¡œ, Schemaë¥¼ ìƒì„±.



## comment front - í”„ë¡ íŠ¸ë‹¨ js

![api](/Image/Express/a4.png)

> Webpackì˜ Url ì •ë¦¬.

![api](/Image/Express/a5.png)

> ë¶ˆëŸ¬ì˜¬ templateì— import

![api](/Image/Express/a6.png)

> ëŒ“ê¸€ì„ submit í•œ í›„, ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ë™ì‘ì„ preventDefaultë¡œ ë§‰ì•„ì¤Œ.

![api](/Image/Express/a7.png)


> datasetì— ì–´ëŠ ë¹„ë””ì˜¤ì¸ì§€ì— ëŒ€í•œ ì •ë³´ ë“¤ì–´ìˆìŒ.

> ëˆ„ê°€ ëŒ“ê¸€ì˜ ì£¼ì¸ì¸ì§€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì•Œë ¤ì¤€ë‹¤ë©´, ë³´ì•ˆì— ì·¨ì•½í•´ì§€ë¯€ë¡œ, ëŒ“ê¸€ì˜ ì£¼ì¸ì€ sessionìœ¼ë¡œ ì•Œë ¤ì£¼ë©´ ë¨.

![api](/Image/Express/a8.png)

> ë¡œê·¸ì¸ í–ˆì„ë•Œë§Œ, ëŒ“ê¸€ì„ ë³¼ ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´, ëŒ“ê¸€ì— ëŒ€í•œ í”„ë¡ íŠ¸ jsë„ ifë¬¸ìœ¼ë¡œ ë¶„ê¸°ì²˜ë¦¬ í•´ì¤˜ì•¼í•¨. ì•„ë‹ˆë©´ í”„ë¡ íŠ¸jsì—ì„œ queryselctorë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì—ëŸ¬ê°€ ë‚¨.


> í˜¹ì€

![api](/Image/Express/a10.png) 

> í”„ë¡ íŠ¸ js ë¥¼ ìˆ˜ì •í•´ì„œ ì²˜ë¦¬ - form ì´ ì¡´ì¬í• ë•Œë§Œ, í”„ë¡ íŠ¸ê°€ ë™ì‘í•˜ê²Œ ë§Œë“¤ê¸°.

### í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°±ì—”ë“œë¡œ ì •ë³´ ì „ë‹¬ 

![api](/Image/Express/a9.png) 

> fetchë¥¼ ì‚¬ìš©í•´ urlë¡œ requestí•˜ê¸° (fetchëŠ” jsë¥¼ í†µí•´ requestë¥¼ í•˜ê²Œ ë„ì™€ì¤Œ.)

![api](/Image/Express/a12.png)

> Router ìƒì„±

![api](/Image/Express/a13.png)

> app.use(express.text())ë¥¼ ì´ìš©í•´ì„œ, textë¥¼ requestë¡œ ì „ë‹¬ ê°€ëŠ¥.

â„ï¸ but! textë¿ë§Œ ì•„ë‹ˆë¼, ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì „ë‹¬í•´ì•¼ í•œë‹¤ë©´!?

ğŸ”¥ expressì˜ stringì„ ë°›ì•„ì„œ, jsonìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨!!

![api](/Image/Express/a11.png)

> ì´ ê³¼ì •ì„ ì§„í–‰í•˜ëŠ” ê²ƒ!!

> json ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì™€ ê°™ì€ ê³¼ì •ì´ ë’·ì‘ì—…ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ”ë°

> ì´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„ , ìš°ë¦¬ê°€ ë³´ë‚´ëŠ” string ë¬¸ìì—´ì´ ì‚¬ì‹¤ì€ jsonì„ ìœ„í•œ string ì´ê³ , json ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•´ì•¼í•´! ë¼ê³  ì•Œë ¤ì¤˜ì•¼í•¨.

![api](/Image/Express/a14.png)

> fetchì—ì„œ ì „ë‹¬í•˜ëŠ” ì •ë³´ë¡œ headerì—ëŠ” requestë° ëŒ€í•œ ê¸°ë³¸ì •ë³´ë¥¼ ë‹´ì•„ë†“ëŠ” ê³³.

![api](/Image/Express/a15.png)

> ì •ìƒ ì „ë‹¬!!

![api](/Image/Express/a16.png)

> í˜„ì¬ ì´ ì•±ì—ì„œ ë³´ë‚´ì•¼í•˜ëŠ” ê±´ ëŒ“ê¸€ì— ëŒ€í•œ ë‚´ìš© í•œê°€ì§€ì´ë¯€ë¡œ, textë§Œ ì „ë‹¬.

![api](/Image/Express/a17.png)

> ëŒ“ê¸€ì˜ ë‚´ìš©ì´ ì—†ë‹¤ë©´, ë³´ë‚´ì§€ë§ê³  ê·¸ëƒ¥ return.

## Commenting - backend

* ìš°ë¦¬ê°€ ë°±ì—”ë“œë¡œ ë³´ë‚´ëŠ” ëª¨ë“  requestëŠ” ì¿ í‚¤ì™€ í•¨ê»˜ ì „ë‹¬ëœë‹¤ëŠ” ì‚¬ì‹¤!!

![api](/Image/Express/a18.png)

> fetchì— ì˜í•´ ì „ë‹¬ëœ ì •ë³´ëŠ” ì¿ í‚¤ë¥¼ í¬í•¨í•˜ê³ , ë°±ì—”ë“œëŠ” sessionì—ì„œ ì¼ì¹˜í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ê²Œëœë‹¤.

> sessionì—ëŠ” ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ê°€ ë‹´ê²¨ ìˆìœ¼ë¯€ë¡œ,

![api](/Image/Express/a19.png)
![api](/Image/Express/a20.png)

> userì— ëŒ€í•œ ì •ë³´ë¥¼ ëª¨ë‘ ë°›ì•„ì˜´.

* ì¿ í‚¤ì˜ ì›ì¹™ì— ì˜í•´ì„œ, ë¸Œë¼ìš°ì €ì˜ ë™ì‘ì›ë¦¬ì— ì˜í•´ì„œ, fetchì‹œ, ì¿ í‚¤ëŠ” ìë™ìœ¼ë¡œ ë³´ë‚´ì§€ê²Œ ëœë‹¤!

![api](/Image/Express/a22.png)

> DBì— ëŒ“ê¸€ ë§Œë“¤ì–´ ì €ì¥.

* ìƒíƒœì½”ë“œ 201: ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë§Œë“¤ì—ˆì„ë•Œ ë³´ëƒ„.

![api](/Image/Express/a23.png)

> ì •ìƒì ìœ¼ë¡œ ì €ì¥!


### ëŒ“ê¸€ ì „ì†¡ì‹œ, ëŒ“ê¸€ ë‚´ìš© ë¹„ìš°ê¸°

![api](/Image/Express/a21.png)


## Comment Rendering - ì‹¤ì‹œê°„

![api](/Image/Express/a25.png)

> populateë¡œ commentsë¥¼ ì¶”ê°€í•´ì¤˜ë„, ëŒ“ê¸€ì´ í•˜ë‚˜ë„ ì•ˆë‚˜ì˜¤ëŠ”ë°, ê·¸ ì´ìœ ëŠ” ë¹„ë””ì˜¤ ì •ë³´ë¥¼ ëŒ“ê¸€ì´ ë‹¬ë¦° í›„ ì—…ë°ì´íŠ¸ê°€ ì•ˆë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤!!

* ëŒ“ê¸€ ìƒì„±í›„ ë¹„ë””ì˜¤ ì •ë³´ ì—…ë°ì´íŠ¸

![api](/Image/Express/a26.png)

> ìƒˆë¡œê³ ì¹¨ì‹œ ë¹„ë””ì˜¤ ë°ì´í„° ì—…ë°ì´íŠ¸.
(ë‹¤ë¥¸ DBë“¤ê³¼ ë‹¤ë¥´ê²Œ mongoDBì—ì„œëŠ” ì†ìˆ˜ _idë¥¼ ë„£ëŠ”ê³¼ì •ì„ í•´ì£¼ëŠ” ê²ƒ.)

![api](/Image/Express/a27.png)

> reverse() í•¨ìˆ˜ë¡œ ìµœì‹  ëŒ“ê¸€ì´ ìœ„ë¡œ ì˜¬ë¼ê°€ê²Œ. (ê·¸ëƒ¥ ë°°ì—´ì„ ë’¤ì§‘ê¸°)

### ìë™ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì‹¤ì‹œê°„ì²˜ëŸ¼ ë³´ì´ê²Œ

![api](/Image/Express/a28.png)

> windowí•¨ìˆ˜ë¡œ ìë™ìœ¼ë¡œ ëŒ“ê¸€ì„ ì „ë‹¬í•˜ë©´, ìƒˆë¡œê³ ì¹¨ì„ í•˜ê²Œí•´ì„œ ì‹¤ì‹œê°„ì²˜ëŸ¼ ë³´ì¼ìˆ˜ ìˆë‹¤

> await fetch : fetchë¼ëŠ”ê±´ ë°±ì—”ë“œì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê³  ëŒì•„ì˜¤ëŠ” ê±´ë°, ê·¸ê±¸ awaitê¸°ë‹¤ë ¤ ì¤«ë‹¤ê°€ ë’· ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ê²ƒì´ë‹¤.
awaitì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´, ì•„ì§ ë°±ì—”ë“œì—ì„œ ì‘ì—…ì´ ë‹¤ ë§ˆì¹˜ì§€ ì•Šê³ , DBì— ìƒˆ ëŒ“ê¸€ì´ ì €ì¥ì´ ì•ˆë˜ì–´ìˆì„ìˆ˜ ìˆìœ¼ë‹ˆ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆë‹¤.

ğŸ”¥ ì£¼ì˜í• ì  :  awaitëŠ” fetchê°€ ëë‚˜ê¸¸ë§Œì„ ê¸°ë‹¤ë¦¬ëŠ”ê±°ì§€, ì„±ê³µí•œê±´ ê¸°ë‹¤ë¦¬ì§„ ì•ŠëŠ”ë‹¤. - 404ë¡œ ë°±ì—”ë“œì—ì„œ ë§ˆë¬´ë¦¬ë˜ë„, ë‹¤ ê¸°ë‹¤ë¦°ê±°ë‚˜ ë‹¤ë¦„ì—†ë‹¤


## Realtime comment

* await fetch ì´í›„, returnê°’ìœ¼ë¡œ promiseê°€ ëŒì•„ì˜¤ëŠ”ë°, ê·¸ ì‘ë‹µì„ ë°›ì•„ì„œ, ì‘ë‹µë³„ë¡œ ë¶„ê¸° ì²˜ë¦¬í•´ì£¼ê¸°.

![api](/Image/Express/a29.png)
![api](/Image/Express/a30.png)

> promise ì—” statusCodedml ì •ë³´ë„ ëŒì•„ì˜¨ë‹¤.

![api](/Image/Express/a31.png)
![api](/Image/Express/a32.png)

> promise ì•ˆì˜ {status}ë§Œ ì§ì ‘ ë°›ì•„ì„œ, í™•ì¸í•˜ê¸°.

### pugì—ì„œ ë¶ˆëŸ¬ì˜¨ ëŒ“ê¸€ì´ ì•„ë‹Œ htmlì„ ë³µë¶™í•œê²ƒ ê°™ì€ ê°€ì§œ ëŒ“ê¸€ ë§Œë“¤ê¸°.


![api](/Image/Express/a33.png)
![api](/Image/Express/a34.png)

> pugì—ì„œ ëœë”ë§í•˜ëŠ” htmlê³¼ ë™ì¼í•œ htmlêµ¬ì„±ë“¤ì„ í”„ë¡ íŠ¸ jsë¥¼ ì´ìš©í•´ì„œ ì§ì ‘ ë§Œë“¤ì–´ì¤Œ.

![api](/Image/Express/a35.png)

* appendChild : element ë¶™ì´ê¸°

* prepend : element ì•ì— ë¶™ì´ê¸°



## user's id ë„˜ê²¨ì£¼ê¸°

![api](/Image/Express/a36.png)
![api](/Image/Express/a37.png)
![api](/Image/Express/a38.png)
![api](/Image/Express/a39.png)

> ëŒ“ê¸€ ì‚­ì œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´, _idì¼ì¹˜ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ë³¸ì¸ì˜ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ _idë¥¼ ë„˜ê²¨ì¤€ë‹¤.

> response.json : responseì—ì„œ jsonë°ì´í„°ë§Œ ì¶”ì¶œ.





































