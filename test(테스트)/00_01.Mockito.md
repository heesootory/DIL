# Mockito



## ğŸŒˆ Mockito ë€?

* Mock: ì§„ì§œ ê°ì²´ì™€ ë¹„ìŠ·í•˜ê²Œ ë™ì‘í•˜ì§€ë§Œ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§ì ‘ ê·¸ ê°ì²´ì˜ í–‰ë™ì„ ê´€ë¦¬í•˜ëŠ” ê°ì²´.

* Mockito : Mock ê°ì²´ë¥¼ ì‰½ê²Œ ë§Œë“¤ê³  ê´€ë¦¬í•˜ê³  ê²€ì¦í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µ.

* ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ = ìœ ë‹› í…ŒìŠ¤íŠ¸

* ìŠ¤í”„ë§ ë¶€íŠ¸ 2.2+ í”„ë¡œì íŠ¸ ìƒì„±ì‹œ spring-boot-starter-testì—ì„œ ìë™ìœ¼ë¡œ Mockito ì¶”ê°€ë¨.

* ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ì‹œ,
    ```yml
    <dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-core</artifactId>
    <version>3.1.0</version>
    <scope>test</scope>
    </dependency>


    <dependency>
        <groupId>org.mockito</groupId>
        <artifactId>mockito-junit-jupiter</artifactId>
        <version>3.1.0</version>
        <scope>test</scope>
    </dependency>
    ```

* 3ê°€ì§€ë§Œ ê¸°ì–µí•˜ë©´ mockì„ ì‚¬ìš©í•˜ê¸°ëŠ” ë§¤ìš° ì‰¬ì›€.
    - mockì„ ë§Œë“œëŠ” ë°©ë²•
    - mockì´ ì–´ë–»ê²Œ ë™ì‘í•´ì•¼ í•˜ëŠ”ì§€ ê´€ë¦¬í•˜ëŠ” ë°©ë²•.
    - mockì˜ í–‰ë™ì„ ê²€ì¦í•˜ëŠ” ë°©ë²•.

<br>
<br>
<hr>
<br>
<br>

## ğŸŒˆ Mockito ì‚¬ìš©í•˜ê¸°

<br>
<br>

### ğŸ³ Mock ê°ì²´ë¥¼ ë§Œë“œëŠ” 3ê°€ì§€ ë°©ë²•

* ìƒí™© : StudyServiceì— ëŒ€í•œ testë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ë°, MemberServiceì™€ StudyRepositoryê°€ ë‘˜ë‹¤ êµ¬í˜„ì²´ëŠ” ì—†ëŠ” interfaceì¸ ê²½ìš°, StudyService ê°ì²´ë¥¼ ë§Œë“œëŠ”ê²ƒ ì¡°ì°¨ ë¶ˆê°€ëŠ¥ í•˜ë¯€ë¡œ, Mockì´ ê·¸ ì—­í• ì„ ëŒ€ì‹  í•´ì¤Œ.

```java
public class StudyService {

    private final MemberService memberService;

    private final StudyRepository repository;

    public Study createNewStudy(Long memberId, Study study) {
        Optional<Member> member = memberService.findById(memberId);
        if (member.isPresent()) {
            study.setOwnerId(memberId);
        } else {
            throw new IllegalArgumentException("Member doesn't exist for id: '" + memberId + "'");
        }
        Study newstudy = repository.save(study);
        memberService.notify(newstudy);
        return newstudy;
    }
}
```

#### ğŸ¯ Mockë¥¼ ì´ìš©í•˜ì—¬ ê°ì²´ë¥¼ test í•¨ìˆ˜ë‚´ì—ì„œ ì§ì ‘ ë§Œë“œëŠ” ê²½ìš°.

```java
import static org.mockito.Mockito.mock;

@Test
@DisplayName("ëª©ê°ì²´ ìƒì„±")
void createStudyService(){

    MemberService memberService = mock(MemberService.class);
    StudyRepository studyRepository = mock(StudyRepository.class);

    StudyService studyService = new StudyService(memberService, studyRepository);

    assertNotNull(studyService);
}
```

<br>

#### ğŸ¯ ëª©ê°ì²´ë¥¼ ì—¬ëŸ¬ testì—ì„œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°, test í•¨ìˆ˜ ë°–ì—ì„œ ì„ ì–¸í•˜ê¸°

* í•¨ìˆ˜ ë°–ì—ì„œ Mockì„ ì„ ì–¸í•˜ê¸° ìœ„í•´ì„ , @ExtendWith(MockitoExtension.class)ë¥¼ class ë ˆí¼ëŸ°ìŠ¤ì— ì •ì˜í•´ ì¤˜ì•¼í•¨.

```java
@ExtendWith(MockitoExtension.class)
class StudyServiceTest {

    @Mock
    MemberService memberService;
    @Mock
    StudyRepository studyRepository;

    @Test
    @DisplayName("ëª©ê°ì²´ ìƒì„±")
    void createStudyService(){

        StudyService studyService = new StudyService(memberService, studyRepository);

        assertNotNull(studyService);
    }

}
```

<br>


#### ğŸ¯ Mock ê°ì²´ë¥¼ ì§ì ‘ testí•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì–´ì£¼ëŠ” ê²½ìš°.

* í•¨ìˆ˜ ë°–ì—ì„œ Mockì„ ì„ ì–¸í•˜ê¸° ìœ„í•´ì„ , @ExtendWith(MockitoExtension.class)ë¥¼ class ë ˆí¼ëŸ°ìŠ¤ì— ì •ì˜í•´ ì¤˜ì•¼í•¨.

```java
@ExtendWith(MockitoExtension.class)
class StudyServiceTest {

    @Test
    @DisplayName("ëª©ê°ì²´ ìƒì„±")
    void createStudyService(@Mock MemberService memberService, @Mock StudyRepository studyRepository){
        StudyService studyService = new StudyService(memberService, studyRepository);
        assertNotNull(studyService);
    }
}
```

<br>
<br>
<hr>
<br>
<br>


## ğŸŒˆ Mockito ê°ì²´ Stubbing

<br>

> Mock ê°ì²´ íŠ¹ì • ìƒí™©ìœ¼ë¡œ í–‰ë™ì„ ì¡°ì •í•˜ê¸°.(Mockê°ì²´ ì—°ê¸°ì ë§Œë“¤ê¸°)

> when ì„ ì‚¬ìš©í•´ì„œ ìƒí™©ì„ ì •ì˜.

* ëª¨ë“  Mock ê°ì²´ì˜ í–‰ë™.
    - nullì„ ë¦¬í„´í•œë‹¤.
    - Primitive íƒ€ì…ì€ ê¸°ë³¸ Primitive ê°’.
    - ì½œë ‰ì…˜ì€ ë¹„ì–´ìˆëŠ” ì½œë ‰ì…˜
    - Void ë©”ì†Œë“œëŠ” ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•Šê³  ì•„ë¬´ëŸ° ì¼ë„ ë°œìƒí•˜ì§€ ì•ŠìŒ.

<br>

* Mockê°ì²´ë¥¼ ì¡°ì‘í•´ì„œ
    - íŠ¹ì • ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì€ ê²½ìš°, íŠ¹ì •í•œ ê°’ì„ ë¦¬í„´í•˜ê±°ë‚˜ ì˜ˆì™¸ë¥¼ ë˜ì§ˆ ìˆ˜ ìˆìŒ.
        - [How about some stubbing - ê³µì‹ë¬¸ì„œ](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html#2)
        - [Argument matchers](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html#3)
    - void ë©”ì†Œë“œ íŠ¹ì • ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ê±°ë‚˜ í˜¸ì¶œëœ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒ ì‹œí‚¬ ìˆ˜ ìˆìŒ.
    - ë©”ì†Œë“œê°€ ë™ì¼í•œ ë§¤ê°œë³€ìˆ˜ë¡œ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œë  ë•Œ ê°ê¸° ë‹¤ë¥´ê²Œ í–‰ë™í•˜ë„ë¡ ì¡°ì‘í•  ìˆ˜ë„ ìˆìŒ.

<br>

### ğŸ³ Argument matchers ì„¤ì •

<br>

* íŠ¹ì • ìƒí™© ì„¤ì •

```java
@Mock MemberService memberService;
@Mock StudyRepository studyRepository;

@Test
@DisplayName("ëª©ê°ì²´ ìƒì„±")
void createStudyService(){
    StudyService studyService = new StudyServic(memberService, studyRepository);
    assertNotNull(studyService);

    // member 1ê°œ ìƒì„±
    Member member = new Member();
    member.setId(1L);
    member.setEmail("heesoo@email.com");

    // ğŸš€ ìƒí™© ì„¤ì •: ë©¤ë²„ ì•„ì´ë””ê°€ 1Lì„ ì°¾ëŠ” ê²½ìš° -> ìœ„ì˜ ë©¤ë²„ë¥¼ ë¦¬í„´í•´ë¼.
    when(memberService.findById(1L)).thenReturn(Optional.of(member));

    // test - ìƒí™©ì„¤ì •ì— ë§ê²Œ testê°€ ì§„í–‰ë¨!!
    Optional<Member> findById = memberService.findById(1L);
    assertEquals("heesoo@email.com", findById.get().getEmail());
    
}

```

> ğŸš€ DBê°€ ì—°ê²°ì´ ì•ˆë˜ì–´ ìˆëŠ” ìƒí™©ì—ì„œë„ ìœ„ì™€ ê°™ì´ ìƒí™© ì„¤ì •ë§Œ í•´ì¤¬ì„ ë¿ì¸ë°, ê·¸ ë’¤ì—ì„œ testí•œ ì½”ë“œê°€ ì •ìƒ ì¶œë ¥ì„ ë±‰ìŒ. ğŸš€

<br>
<br>
<br>

* any ìƒí™© ì„¤ì •

```java
@Mock MemberService memberService;
@Mock StudyRepository studyRepository;

@Test
@DisplayName("ëª©ê°ì²´ ìƒì„±")
void createStudyService(){
    StudyService studyService = new StudyService(memberService, studyRepository);
    assertNotNull(studyService);

    // member 1ê°œ ìƒì„±
    Member member = new Member();
    member.setId(1L);
    member.setEmail("heesoo@email.com");

    // ğŸš€ ìƒí™© ì„¤ì •: ë©¤ë²„ ì•„ì´ë””ê°€ ì–´ë–¤ ê²½ìš°ë“  -> ìœ„ì˜ ë©¤ë²„ë¥¼ ë¦¬í„´í•´ë¼.
    when(memberService.findById(any())).thenReturn(Optional.of(member));

    // test - ì–´ë–¤ ë©¤ë²„ ì•„ì´ë””ë¥¼ í˜¸ì¶œí•˜ë“  ì •ìƒ ì¶œë ¥.
    assertEquals("heesoo@email.com", memberService.findById(1L).get().getEmail());
    assertEquals("heesoo@email.com", memberService.findById(2L).get().getEmail());
}

```

<br>
<br>

* íŠ¹ì • ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì„ì‹œ, ì˜ˆì™¸ ë˜ì§€ê¸°
    - thenThrow 
    ```java
    // ğŸš€ ìƒí™© ì„¤ì • : ë©¤ë²„ ì•„ì´ë””ê°€ 1Lì´ ë“¤ì–´ì˜¤ë©´, ëŸ°íƒ€ì„ ì˜ˆì™¸ë¥¼ ë˜ì ¸ë¼.
    when(memberService.findById(1L)).thenThrow(new RuntimeException());
    ```

    - doThrow
    ```java
    @Test
    void ExceptionTest(){
        // ğŸš€ ìƒí™© ì„¤ì • : ì˜ˆì™¸ë¥¼ ë˜ì ¸ë¼, memberServiceì— 1Lì´ ìœ íš¨í•œì§€ ë“¤ì–´ì˜¬ë•Œ
        doThrow(new IllegalArgumentException()).when(memberService).validate(1L);

        // ì˜ˆì™¸ìƒí™©ì— ëŒ€í•œ test
        assertThrows(IllegalArgumentException.class, () -> {
            memberService.validate(1L);
        });

        // ì˜ˆì™¸ ë°œìƒ x
        memberService.validate(2L);

    }
    ```


* ë™ì¼í•œ ë§¤ê°œë³€ìˆ˜ë¡œ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œ ê°€ëŠ¥

```java
@Mock MemberService memberService;
@Mock StudyRepository studyRepository;

@Test
@DisplayName("ëª©ê°ì²´ ìƒì„±")
void createStudyService(){
    StudyService studyService = new StudyService(memberService, studyRepository);
    assertNotNull(studyService);

    // member 1ê°œ ìƒì„±
    Member member = new Member();
    member.setId(1L);
    member.setEmail("heesoo@email.com");

    // ìƒí™© ì„¤ì •
    when(memberService.findById(any()))
            .thenReturn(Optional.of(member))        // ì •ìƒ ë©¤ë²„ ë°˜í™˜
            .thenThrow(new RuntimeException())       // ì˜ˆì™¸ ë˜ì§€ê¸°
            .thenReturn(Optional.empty());      // ë¹ˆ ê°ì²´ ë°˜í™˜

    // test - ì–´ë–¤ ê²½ìš°ì—ë„ ì •ìƒ ì¶œë ¥
    Optional<Member> byId = memberService.findById(1L);
    assertEquals("heesoo@email.com", byId.get().getEmail());

    assertThrows(RuntimeException.class, () -> {
        memberService.findById(2L);
    });

    assertEquals(Optional.empty(), memberService.findById(3L));
}
```



























